<!DOCTYPE html>
<html lang="id">
<head>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Incident Report</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      background-color: #121212;
      color: #ffffff;
    }
    .form-control, .form-select {
      background-color: #1e1e1e;
      color: #fff;
      border: 1px solid #444;
    }
    .form-control:focus, .form-select:focus {
      background-color: #1e1e1e;
      color: #fff;
    }
    .btn-custom {
      background-color: #ff5722;
      border: none;
      color: white;
    }
    .btn-custom:hover {
      background-color: #e64a19;
    }
    #result {
      white-space: pre-wrap;
      background: #333;
      padding: 15px;
      border-radius: 5px;
      margin-top: 20px;
    }
  </style>
</head>
<!-- Tombol Kembali ke Menu -->
<a href="menu.html" class="btn btn-outline-light position-absolute top-0 start-0 m-3">
  â¬… Kembali ke Menu
</a>
</div>

<body class="container py-4">
  <h1 class="text-center mb-4">Metropolitan Incident Report Form</h1>

  <form id="bbcode-form">
    <div class="mb-3">
      <label class="form-label">Fullname</label>
      <input type="text" name="fullname" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">location and Time</label>
      <input type="text" name="location" class="form-control">
    </div>
    <div class="mb-3">
      <label class="form-label">Person in-charge of use of force</label>
      <input type="text" name="person_in_charge" class="form-control">
    </div>
<div class="mb-3">
  <label class="form-label">Weapons usage</label><br>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Tazer" id="weapon-tazer">
    <label class="form-check-label" for="weapon-tazer">Tazer</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Handgun" id="weapon-handgun">
    <label class="form-check-label" for="weapon-handgun">Handgun</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Rubber Shotgun" id="weapon-rubber">
    <label class="form-check-label" for="weapon-rubber">Rubber Shotgun</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Lethal Shotgun" id="weapon-lethal">
    <label class="form-check-label" for="weapon-lethal">Lethal Shotgun</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Submachine Guns" id="weapon-smg">
    <label class="form-check-label" for="weapon-smg">Submachine Guns</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Automatic Rifle" id="weapon-auto">
    <label class="form-check-label" for="weapon-auto">Automatic Rifle</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="weapon" value="Take Tire" id="weapon-tire">
    <label class="form-check-label" for="weapon-tire">Take Tire</label>
  </div>
    </div>
<div class="mb-3">
  <label class="form-label">Category of incident</label><br>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="OIS (Officer Involved Shooting)" id="cat-ois">
    <label class="form-check-label" for="cat-ois">OIS (Officer Involved Shooting)</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="ICD (In Custody Death)" id="cat-icd">
    <label class="form-check-label" for="cat-icd">ICD (In Custody Death)</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="LERI (Law Enforcement Related Injury)" id="cat-leri">
    <label class="form-check-label" for="cat-leri">LERI (Law Enforcement Related Injury)</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="CUOF (Categorical Use of Force)" id="cat-cuof">
    <label class="form-check-label" for="cat-cuof">CUOF (Categorical Use of Force)</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="NTUD (Non-Tactical Unintentional Discharge)" id="cat-ntud">
    <label class="form-check-label" for="cat-ntud">NTUD (Non-Tactical Unintentional Discharge)</label>
  </div>
  <div class="form-check">
    <input class="form-check-input" type="checkbox" name="incident_category" value="TUD (Tactical Unintentional Discharge)" id="cat-tud">
    <label class="form-check-label" for="cat-tud">TUD (Tactical Unintentional Discharge)</label>
  </div>
</div>
<div class="mb-3">
  <label class="form-label">Name of suspect</label>
  <textarea name="suspect_identification" class="form-control"></textarea>
</div>

<div class="mb-3">
  <label class="form-label">ID CARD SUSPECT (CROP)</label>
  <input type="file" name="suspect_photo_file" id="suspect-photo-input" accept="image/*" class="form-control">
  <input type="hidden" name="suspect_photo_url" id="suspect-photo-url">
</div>
    <div class="mb-3">
      <label class="form-label">Evidence Collect (Upload Gambar)</label>
      <input type="file" name="evidence_collect_file" id="evidence-collect-input" accept="image/*" class="form-control">
      <input type="hidden" name="evidence_collect_url" id="evidence-collect-url">
    </div>
<div class="mb-3">
  <label class="form-label">Arrest Record (Upload Gambar)</label>
  
  <!-- File input disembunyikan -->
  <input type="file" id="arrest-record-input" accept="image/*" class="d-none">
  
  <!-- Label kustom yang tampil di tempatnya -->
  <label for="arrest-record-input" id="arrest-record-label" class="form-control bg-dark text-light">
    Upload bukti Arrest Record suspect di /mdc
  </label>

  <!-- Hidden input tetap untuk URL Imgur -->
  <input type="hidden" name="arrest_record_url" id="arrest-record-url">
</div>

      <input type="hidden" name="arrest_record_url" id="arrest-record-url">
    </div>
    <div class="mb-3">
      <label class="form-label">Kronologi Insiden</label>
      <textarea name="chronology" class="form-control"></textarea>
    </div>
    <div class="mb-3">
      <label class="form-label">Foto Kejadian (Upload Gambar)</label>
      <input type="file" name="incident_photo" id="incident-photo-input" accept="image/*" class="form-control">
      <input type="hidden" name="incident_photo_url" id="incident-photo-url">
    </div>

    <button type="button" id="generate" class="btn btn-custom">Buat BBCode</button>
    <button type="button" id="copy-btn" class="btn btn-secondary ms-2">Copy All</button>
  </form>

  <div id="result"></div>

  <!-- Script Imgur & Generate BBCode sama seperti sebelumnya -->
  <script>
async function uploadToImgur(file) {
  const formData = new FormData();
  formData.append('image', file);

  const response = await fetch('https://api.imgur.com/3/image', {
    method: 'POST',
    headers: {
      Authorization: 'Client-ID 894beeef6cd80f4'
    },
    body: formData
  });

  const data = await response.json();
  if (data.success) {
    return data.data.link;
  } else {
    throw new Error('Upload gagal ke Imgur.');
  }
}

// Upload Evidence Collect
document.getElementById('evidence-collect-input').addEventListener('change', async (event) => {
  const file = event.target.files[0];
  const input = event.target;

  if (file) {
    try {
      input.disabled = true; // Disable input saat upload

      const spinner = document.createElement('div');
      spinner.className = "spinner-border text-light mt-2";
      spinner.role = "status";
      const spinnerText = document.createElement('span');
      spinnerText.className = "visually-hidden";
      spinnerText.innerText = "Loading...";
      spinner.appendChild(spinnerText);

      input.parentNode.appendChild(spinner);

      const url = await uploadToImgur(file);
      document.getElementById('evidence-collect-url').value = url;

      spinner.remove();
      input.disabled = false;

      const uploaded = document.createElement('p');
      uploaded.className = "mt-2";
      uploaded.innerHTML = `<strong>Uploaded:</strong> <a href="${url}" target="_blank" class="text-info">${url}</a>`;
      input.parentNode.appendChild(uploaded);

    } catch (err) {
      input.disabled = false;
      alert('Gagal upload Evidence: ' + err.message);
    }
  }
});

document.getElementById('suspect-photo-input').addEventListener('change', async (event) => {
  const file = event.target.files[0];
  const input = event.target;

  if (file) {
    try {
      input.disabled = true;

      const spinner = document.createElement('div');
      spinner.className = "spinner-border text-light mt-2";
      spinner.role = "status";
      const spinnerText = document.createElement('span');
      spinnerText.className = "visually-hidden";
      spinnerText.innerText = "Loading...";
      spinner.appendChild(spinnerText);

      input.parentNode.appendChild(spinner);

      const url = await uploadToImgur(file);
      document.getElementById('suspect-photo-url').value = url;

      spinner.remove();
      input.disabled = false;

      const uploaded = document.createElement('p');
      uploaded.className = "mt-2";
      uploaded.innerHTML = `<strong>Uploaded:</strong> <a href="${url}" target="_blank" class="text-info">${url}</a>`;
      input.parentNode.appendChild(uploaded);

    } catch (err) {
      input.disabled = false;
      alert('Gagal upload gambar: ' + err.message);
    }
  }
});


// Upload Arrest Record
document.getElementById('arrest-record-input').addEventListener('change', async (event) => {
  const file = event.target.files[0];
  const input = event.target;

  if (file) {
    try {
      input.disabled = true; // Disable input saat upload

      const spinner = document.createElement('div');
      spinner.className = "spinner-border text-light mt-2";
      spinner.role = "status";
      const spinnerText = document.createElement('span');
      spinnerText.className = "visually-hidden";
      spinnerText.innerText = "Loading...";
      spinner.appendChild(spinnerText);

      input.parentNode.appendChild(spinner);

      const url = await uploadToImgur(file);
      document.getElementById('arrest-record-url').value = url;

      spinner.remove();
      input.disabled = false;

      const uploaded = document.createElement('p');
      uploaded.className = "mt-2";
      uploaded.innerHTML = `<strong>Uploaded:</strong> <a href="${url}" target="_blank" class="text-info">${url}</a>`;
      input.parentNode.appendChild(uploaded);

    } catch (err) {
      input.disabled = false;
      alert('Gagal upload Arrest Record: ' + err.message);
    }
  }
});

// Upload Incident Photo
document.getElementById('incident-photo-input').addEventListener('change', async (event) => {
  const file = event.target.files[0];
  const input = event.target;

  if (file) {
    try {
      input.disabled = true; // Disable input saat upload

      const spinner = document.createElement('div');
      spinner.className = "spinner-border text-light mt-2";
      spinner.role = "status";
      const spinnerText = document.createElement('span');
      spinnerText.className = "visually-hidden";
      spinnerText.innerText = "Loading...";
      spinner.appendChild(spinnerText);

      input.parentNode.appendChild(spinner);

      const url = await uploadToImgur(file);
      document.getElementById('incident-photo-url').value = url;

      spinner.remove();
      input.disabled = false;

      const uploaded = document.createElement('p');
      uploaded.className = "mt-2";
      uploaded.innerHTML = `<strong>Uploaded:</strong> <a href="${url}" target="_blank" class="text-info">${url}</a>`;
      input.parentNode.appendChild(uploaded);

    } catch (err) {
      input.disabled = false;
      alert('Gagal upload Incident Photo: ' + err.message);
    }
  }
});

// Generate BBCode
document.getElementById('generate').addEventListener('click', () => {
  const form = document.forms['bbcode-form'];

  const fullname = form['fullname'].value;
  const location = form['location'].value;
  const personInCharge = form['person_in_charge'].value;

const allWeapons = form.querySelectorAll('input[name="weapon"]');
const weapon = Array.from(allWeapons).map(w => {
  return w.checked ? `[cbc] ${w.value}` : `[ ] ${w.value}`;
}).join('\n');


const allCategories = form.querySelectorAll('input[name="incident_category"]');
const incidentCategory = Array.from(allCategories).map(c => {
  return c.checked ? `[cbc] ${c.value}` : `[ ] ${c.value}`;
}).join('\n');


  const suspectIdentification = form['suspect_identification'].value;
  const suspectPhoto = form['suspect_photo_url'].value;
  const chronology = form['chronology'].value;
  const incidentPhoto = form['incident_photo_url'].value;
  const evidenceURL = form['evidence_collect_url'].value;
  const arrestURL = form['arrest_record_url'].value;

  const bbcode = `[divbox=white]
[img]https://i.imgur.com/UZtsPUy.png[/img]
[space]
[hr]
[hr]
[align=center][b][size=170]METROPOLITAN INCIDENT REPORT[/size][/b][/align]
[hr]
[hr]
[table=1,91]
[tr]
[td][align=center][b][size=125]INCIDENT INFORMATION FORMAT[/size][/b][/align][/table]
[table=1,91]
[tr]
    [td][align=center][b]Officer Information[/b][/align]
    [td]Fullname: ${fullname}
         Location: ${location}
         Person in-charge of use of force: ${personInCharge}
         Weapon used at time of incident:
${weapon}
[space]
[tr]
    [td][align=center][b]Category of Incident[/b][/align]
    [td]
${incidentCategory}
[tr]
    [td][align=center][b]Suspect Information[/b][/align]
[td]Fullname :
${suspectIdentification}
ID Card suspect (CROP):
[spoiler]
[img]${suspectPhoto}[/img]
[/spoiler]
Evidence Collect:
[spoiler]
[img]${evidenceURL}[/img]
[/spoiler]
Charges:
[spoiler]
SS /mdc >> Arrest record suspect
[/spoiler]
Arrest Record:
[spoiler]
[img]${arrestURL}[/img]
[/spoiler]
[/table]
[hr]
[hr]
[align=center][b]Chronology & Photo of Incident[/b][/align]
[hr]
[hr]
Chronology:
[spoiler]
${chronology}
[/spoiler]
Incident Photo:
[spoiler]
[img]${incidentPhoto}[/img]
[/spoiler]
[hr]
[hr]
[align=right]* FOR SERGEANT+ USE ONLY![/align]
[table=1,91]
[tr]
[/table]`;

  document.getElementById('result').textContent = bbcode;
});


// Copy All
document.getElementById('copy-btn').addEventListener('click', () => {
  const result = document.getElementById('result').textContent;
navigator.clipboard.writeText(result)
  .then(() => {
    Swal.fire({
      icon: 'success',
      title: 'Berhasil!',
      text: 'BBCode berhasil disalin ke clipboard.',
      showConfirmButton: false,
      timer: 1500
    });
  })
});
</script>
  </script>
</body>
</html>
